<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Primeiro exercício Leaflet</title>

  <link rel="stylesheet" href="js/leaflet.css">
  <link rel="stylesheet" href="dist/MarkerCluster.css">
  <link rel="stylesheet" href="dist/MarkerCluster.Default.css">

  
  <script src="js/leaflet.js"></script>
  <script src="dist/leaflet.markercluster-src.js"></script>

  <style>
    #map{ height: 100% }
    .legend {
    line-height: 18px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}
  </style>
</head>
<body>

  <div id="map"></div>
  <script src="data/estadios.geojson"></script>
  <script src="data/casospor10khab.geojson"></script>
  <script src="data/casos.geojson"></script>
  
  <script>

  // iniciar o mapa
  var map = L.map('map').setView([38.749, -9.155], 13);

  // carregar um serviço de mapas como mapa base
  	var osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
		maxZoom: 19,
		attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
	}).addTo(map);

  	var grey = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png', {
		maxZoom: 20,
		attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
	});

	L.tileLayer.wms('http://localhost:8080/geoserver/websig/wms?', {
	    layers: 'websig:ACONT_CONC_CAOP2022'
	}).addTo(map);
	
	var estadiosStyle = L.icon({
	iconUrl:'img/Stadium.svg',
	iconSize: [50,40]
	});
	
	var estadiosLayer = L.geoJSON(estadiosData, {
		pointToLayer: function (feature,latlng){
		return L.marker (latlng, {icon: estadiosStyle});
		}
	}).addTo(map);
	
	function getcor10k(d) {
		return d > 8 ?'#ba4a00':
			d > 6 ?'#e67e22':
			d > 4 ?'#239b56':
			d > 2 ?'#186a3b':
						'#FFFFFF';
	}
	
	function estilo10k(feature) {
		return {
			weight: 1,
			opacity: 1,
			color: 'white',
			dashArray: '3',
			fillOpacity: 1.0,
			fillColor: getcor10k(feature.properties.Casos_23_1)
		};
	}
	
	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}
	
	function emcadaConcelho(feature,layer) {
		layer.on({
			click: zoomToFeature
		});
	}
	
	function onEachFeature(feature, layer) {
        	layer.bindPopup('Concelho: ' + feature.properties.Concelho +'<br>' + 'População: ' +feature.properties.POP_2018);
	    }

	var casos10kLayer = L.geoJSON(casos10kData, {
		style: estilo10k, 
		onEachFeature: onEachFeature
	}).addTo(map);
	
	//leaflet scale
		L.control.scale({
			metric: true,
			imperial: false,
			maxWidth: 100,
			position: 'bottomleft'
		}).addTo(map);

		//leaflet layer control
		var baseMaps = {
			'Open Street Map' : osm,
			'Grey map' : grey
		};
		var layers = {
			'Casos por 10 mil habitantes' : casos10kLayer
		};

//leaflet legend
var legend = L.control({position: 'bottomright'});
L.control.layers(baseMaps, layers).addTo(map);

legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend'),
        grades = [2, 4, 6, 8],
        labels = [];

    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getcor10k(grades[i] + 1) + '"></i> ' +
            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
    }

    return div;
};

legend.addTo(map);

	var marcadores = L.markerClusterGroup();
	var casospontoLayer = L.geoJSON(casosponto, {
			//onEachFeature: function(feature, layer) {layer.bindPopup (feature.properties.1);}
	});
	marcadores.addLayer(casospontoLayer);
	map.addLayer(marcadores);

		



	




















  </script>

</body></html>
